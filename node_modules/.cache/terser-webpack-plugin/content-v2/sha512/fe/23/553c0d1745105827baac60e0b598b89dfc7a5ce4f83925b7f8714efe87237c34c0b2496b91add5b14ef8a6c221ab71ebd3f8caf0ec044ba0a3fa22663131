{"code":"!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"\",i(i.s=1)}([function(t,e){let i=!1;document.querySelector(\".navbar\").addEventListener(\"click\",function(t){if(\"li\"===t.target.nodeName.toLowerCase()){let e=t.target;e.getAttribute(\"class\")||(i=!0),[].forEach.call(e.parentElement.children,t=>{t.classList.remove(\"current\")}),e.classList.add(\"current\");let s=document.querySelector(e.dataset.view);s&&([].forEach.call(s.parentElement.children,t=>{t.classList.remove(\"active\")}),s.classList.add(\"active\"))}}),setInterval(function(){i&&(console.log(\"tab changed...\"),window.dispatchEvent(new Event(\"scroll\")),i=!1)},100)},function(t,e,i){\"use strict\";i.r(e);i(0);class s{constructor(t={}){this.$el=t.el,this.slideItems=t.slideItems,this.interval=t.interval||3e3,this.duration=t.duration||300,this.index=0,this.render(),this.start()}render(){this.$el.innerHTML='<div class=\"qq-slider-wrap\"></div>',this.$wrap=this.$el.firstElementChild,this.$wrap.style.transitionDuration=`${this.duration}ms`,this.$wrap.style.width=`${100*this.slideItems.length}%`,this.$wrap.innerHTML=this.slideItems.map(t=>`<div class=\"qq-slider-item\">\\n      <a href=\"${t.link}\">\\n        <img src=\"${t.img}\" alt=\"\">\\n      </a>\\n    </div>`).join(\"\")}start(){setInterval(this.next.bind(this),this.interval)}next(){this.index+=1,this.index===this.slideItems.length&&(this.index=0);let t=`-${100*this.index/this.slideItems.length}%`;this.$wrap.style.transform=`translateX(${t})`}}function r(t){let e=[].slice.call(t||document.querySelectorAll(\".lazyload\")),i=function(t,e){let i,s;return function r(){let n=Date.now(),l=n-i;!i||l>=e?(t(),i=n):l<e&&(clearTimeout(s),s=setTimeout(r,e-l))}}(function(){if(0===e.length)return window.removeEventListener(\"scroll\",i);(e=e.filter(t=>t.classList.contains(\"lazyload\"))).forEach(t=>{(function(t){let{top:e,left:i,right:s,bottom:r}=t.getBoundingClientRect(),n=document.documentElement.clientWidth,l=document.documentElement.clientHeight;return(e>0&&e<l||r>0&&r<l)&&(i>0&&i<n||s>0&&s<n)})(t)&&function(t){let e=new Image;e.src=t.dataset.src,e.onload=function(){t.src=e.src,t.classList.remove(\"lazyload\")}}(t)})},500);window.addEventListener(\"scroll\",i),window.dispatchEvent(new Event(\"scroll\"))}class n{constructor(t,e,i,s){this.$el=t,this.$audio=e,this.duration=i||0,this.progress=0,this.currentTime=0,this.$currentTime=this.$el.querySelector(\".current-time\"),this.$totalTime=this.$el.querySelector(\".total-time\"),this.$totalBar=this.$el.querySelector(\".bar\"),this.$progressBar=this.$el.querySelector(\".progress-now\"),this.$currentTime.innerText=this.formatTime(this.currentTime),this.$totalTime.innerText=this.formatTime(this.duration),s&&this.start()}start(){this.stop(),this.intervalId=setInterval(this.update.bind(this),50)}stop(){clearInterval(this.intervalId)}update(){this.currentTime=Math.round(this.$audio?this.$audio.currentTime:this.currentTime+.05),this.currentTime>this.duration&&this.reset(),this.progress=this.currentTime/this.duration,this.$progressBar.style.transform=`translateX(${100*this.progress-100}%)`,this.$currentTime.innerText=this.formatTime(this.currentTime)}reset(t){this.stop(),this.currentTime=0,this.progress=0,this.$progressBar.style.transform=\"translateX(-100%)\",this.$currentTime.innerText=this.formatTime(this.currentTime),t&&(this.duration=parseInt(t,10),this.$totalTime.innerText=this.formatTime(this.duration))}restart(){this.reset(),this.start()}formatTime(t){let e=\"\"+Math.floor(t/60),i=\"\"+Math.floor(t%60);return(e=1===e.length?\"0\"+e:e)+\":\"+(i=1===i.length?\"0\"+i:i)}}class l{constructor(t,e){this.$el=t,this.$el.innerHTML='<div class=\"player-lyrics-lines\"></div>',this.$lines=this.$el.querySelector(\".player-lyrics-lines\"),this.$audio=e,this.text=\"\",this.lyricsArr=[],this.currentTime=0,this.index=0,this.reset(this.text)}renderLyrics(t){let e=[];t.split(\"\\n\").forEach(function(t){let i=t.match(/\\d{2}:\\d{2}/g),s=t.replace(/\\[.+?\\]/g,\"\");Array.isArray(i)&&\"\"!=s&&i.forEach(function(t){e.push({time:t,value:s})})}),e.sort(this.byField(\"time\")),this.lyricsArr=e,e.length&&(this.$lines.innerHTML=e.map((t,e)=>`\\n      <div class=\"player-lyric line-${e+1}\">${t.value}</div>`).join(\"\"))}reset(t){this.stop(),this.index=0,this.currentTime=0,this.$lines.style.transform=\"translateY(0)\";let e=this.$lines.querySelector(\".active\");e&&e.classList.remove(\"active\"),t&&(this.text=this.formatText(t)||\"\",this.renderLyrics(this.text)),this.lyricsArr.length&&this.$lines.children[this.index].classList.add(\"active\")}start(){this.stop(),this.intervalId=setInterval(this.update.bind(this),1e3)}stop(){clearInterval(this.intervalId)}update(){if(this.currentTime=Math.round(this.$audio?this.$audio.currentTime:this.currentTime+1),this.index===this.lyricsArr.length-1)return this.reset();for(let t=this.index+1;t<this.lyricsArr.length;t++){let e=this.getSeconds(this.lyricsArr[t].time);if(this.currentTime==e&&(!this.lyricsArr[t+1]||this.currentTime<this.getSeconds(this.lyricsArr[t+1].time))){this.$lines.children[this.index].classList.remove(\"active\"),this.$lines.children[t].classList.add(\"active\"),this.index=t;break}}if(this.index>2){let t=-(this.index-2)*this.LINE_HEIGHT;this.$lines.style.transform=`translateY(${t}px)`}}restart(){this.reset(),this.play()}getSeconds(t){return t.replace(/(\\d{2}):(\\d{2})/,(t,e,i)=>60*parseInt(e,10)+parseInt(i,10))}formatText(t){let e=document.createElement(\"div\");return e.innerHTML=t,e.innerText}byField(t){return function(e,i){return e[t]>i[t]?1:-1}}}l.prototype.LINE_HEIGHT=30;new class{constructor(t){this.$el=t,this.launch()}launch(){fetch(\"https://qq-music-api.now.sh\").then(t=>t.json()).then(t=>this.json=t).then(()=>this.renderRecm())}renderRecm(){this.renderSlider(this.json.data.slider),this.renderRadio(this.json.data.radioList),this.renderHotSong(this.json.data.songList),r(this.$el.querySelectorAll(\".lazyload\"))}renderSlider(t){this.slider=new s({el:this.$el.querySelector(\".qq-slider\"),slideItems:t.map(t=>({link:t.linkUrl,img:t.picUrl}))})}renderRadio(t){this.$el.querySelector(\".radio .list-container\").innerHTML=t.map(t=>`<li class=\"list-item\">\\n      <a href=\"#\">\\n        <div class=\"item-media\">\\n          <img class=\"lazyload\" src=\"images/static.jpg\" data-src=\"${t.picUrl}\" alt=\"\">\\n          <span class=\"icon\"></span>\\n        </div>\\n        <div class=\"item-info\">\\n          <h3>${t.Ftitle}</h3>\\n        </div>\\n      </a>\\n    </li>`).join(\"\")}renderHotSong(t){this.$el.querySelector(\".hot-song .list-container\").innerHTML=t.map(t=>`<li class=\"list-item\">\\n      <a href=\"#\">\\n        <div class=\"item-media\">\\n          <img class=\"lazyload\" src=\"images/static.jpg\" data-src=\"${t.picUrl}\" alt=\"\">\\n          <span class=\"icon\"></span>\\n        </div>\\n        <div class=\"item-info\">\\n          <h3>${t.songListDesc}</h3>\\n        </div>\\n      </a>\\n    </li>`).join(\"\")}}(document.querySelector(\"#recommend-view\")),new class{constructor(t){this.$el=t,this.launch()}launch(){fetch(\"https://qq-music-api.now.sh/top\").then(t=>t.json()).then(t=>this.list=t.data.topList).then(()=>this.renderRank())}renderRank(){this.$el.querySelector(\".top-list-wrap\").innerHTML=this.list.map(t=>`<li class=\"top-item\">\\n      <a href=\"#\">\\n        <div class=\"item-img\"><img class=\"lazyload\" src=\"images/static.jpg\" data-src=\"${t.picUrl}\" alt=\"\"></div>\\n        <div class=\"item-content\">\\n          <div class=\"topic ellipsis\">${t.topTitle}</div>\\n          ${this.createSongList(t.songList)}\\n          <i class=\"topic-arrow\">></i>\\n        </div>\\n      </a>\\n    </li>`).join(\"\"),r(this.$el.querySelectorAll(\".lazyload\"))}createSongList(t){return t.map((t,e)=>`<div class=\"song-detail ellipsis\">${e+1}\\n      <span class=\"song-name\">${t.songname}</span>- ${t.singername}</div>`).join(\"\")}}(document.querySelector(\"#rank-view\")),new class{constructor(t){this.$el=t,this.$input=this.$el.querySelector(\"#search\"),this.$btn=this.$el.querySelector(\".search-btn\"),this.$songs=this.$el.querySelector(\".search-song-list\"),this.keyword=\"\",this.page=1,this.perpage=20,this.songs={},this.nomore=!1,this.fetching=!1,this.getTotalNum=0,this.$input.addEventListener(\"keyup\",this.onKeyUp.bind(this)),this.$btn.addEventListener(\"click\",this.onClick.bind(this)),this.onscroll=this.onScroll.bind(this),window.addEventListener(\"scroll\",this.onscroll)}onKeyUp(t){t.target.value.trim()||this.reset()}onClick(t){let e=this.$input.value.trim();if(!e)return this.reset();this.search(e)}search(t,e){\"\"!==t&&(this.keyword===t&&this.songs[e||this.page]||this.fetching||(this.keyword!==t&&this.reset(),this.keyword=t,this.loading(),fetch(`https://qq-music-api.now.sh/search?keyword=${this.keyword}&page=${e||this.page}`).then(t=>t.json()).then(t=>(this.page=t.data.song.curpage,this.getTotalNum+=t.data.song.curnum,this.nomore=this.getTotalNum===t.data.song.totalnum,this.songs[this.page]=t.data.song.list,t.data.song.list)).then(t=>this.append(t)).then(()=>this.done()).catch(()=>this.fetching=!1)))}append(t){this.$songs.innerHTML+=t.map(t=>{let e=t.singer.map(t=>t.name).join(\"、\");return`<li>\\n        <a href=\"#player-panel?artist=${e}&songid=${t.songid}&songname=${t.songname}&albummid=${t.albummid}&duration=${t.interval}\">\\n          <i class=\"icon-music\"></i>\\n          <h6 class=\"main-title ellipsis\">${t.songname}</h6>\\n          <p class=\"sub-title ellipsis\">${e}</p>\\n        </a>\\n      </li>`}).join(\"\")}onScroll(){this.nomore||document.documentElement.clientHeight+pageYOffset>document.body.scrollHeight-50&&this.search(this.keyword,this.page+1)}reset(){this.page=1,this.keyword=\"\",this.songs={},this.getTotalNum=0,this.$songs.innerHTML=\"\",this.nomore=!1,this.$el.querySelector(\".load-done\").classList.add(\"hide\")}loading(){this.fetching=!0,console.log(\"show loading....\"),this.$el.querySelector(\".search-loading\").classList.add(\"show\")}done(){this.fetching=!1,this.nomore?(this.$el.querySelector(\".icon-loading\").style.display=\"none\",this.$el.querySelector(\".loading\").style.display=\"none\",this.$el.querySelector(\".load-done\").classList.remove(\"hide\"),this.$el.querySelector(\".search-loading\").classList.add(\"show\")):this.$el.querySelector(\".search-loading\").classList.remove(\"show\")}}(document.querySelector(\"#search-view\"));let a=new class{constructor(t){this.$el=t,this.$play=this.$el.querySelector(\".panel-header .play\"),this.$el.addEventListener(\"click\",this),this.$audio=this.createAudio(),this.progressBar=new n(this.$el.querySelector(\".player-footer .progress\"),this.$audio),this.lyricsPlayer=new l(this.$el.querySelector(\".lyric-box\"),this.$audio),this.fetching=!1}createAudio(){let t=document.createElement(\"audio\");return t.id=`player-${Math.floor(100*Math.random())}-${+new Date}`,t.addEventListener(\"ended\",()=>{this.lyricsPlayer.restart(),this.progressBar.restart()}),document.body.appendChild(t),t}handleEvent(t){let e=event.target;switch(!0){case e.matches(\".icon-play\"):this.onPlay(e);break;case e.matches(\".icon-pause\"):this.onPause(e);break;case e.matches(\".icon-list\"):this.hide()}}onPlay(t){this.fetching||alert(\"暂时无法播放,请点击列表图标隐藏播放界面\")}onPause(t){t.classList.toggle(\"icon-pause\"),t.classList.toggle(\"icon-play\"),this.progressBar.stop(),this.lyricsPlayer.stop()}play(t){if(!t)return;this.$el.querySelector(\".play-title .name\").innerText=t.songname,this.$el.querySelector(\".play-title .author\").innerText=t.artist,this.progressBar.reset(t.duration);let e=`https://y.gtimg.cn/music/photo_new/T002R150x150M000${t.albummid}.jpg`;this.$el.querySelector(\".album-cover\").src=e,this.$el.querySelector(\".bg-cover\").style.backgroundImage=`url(${e})`,t.songid&&(this.songid!==t.songid&&(this.$play.classList.add(\"icon-play\"),this.$play.classList.remove(\"icon-pause\")),this.songid=t.songid,this.fetching=!0,fetch(`https://qq-music-api.now.sh/lyrics?id=${this.songid}`).then(t=>t.json()).then(t=>t.lyric).then(t=>this.lyricsPlayer.reset(t)).catch(()=>{}).then(()=>this.fetching=!1)),this.show()}show(){this.$el.classList.add(\"show\"),document.body.classList.add(\"noscroll\")}hide(){this.$el.classList.remove(\"show\"),document.body.classList.remove(\"noscroll\")}}(document.querySelector(\"#player-panel\"));function o(){let t=location.hash;if(/^#player-panel\\?.+/.test(t)){let e=t.slice(t.indexOf(\"?\")+1).match(/(\\w+)=([^&]+)/g),i=e&&e.reduce((t,e)=>{let i=e.split(\"=\");return t[i[0]]=decodeURIComponent(i[1]),t},{});a.play(i)}else a.hide()}document.querySelector(\"#header .player-btn\").addEventListener(\"click\",function(){a.show()}),o(),window.addEventListener(\"hashchange\",o)}]);","extractedComments":[]}